{% extends 'base.html' %} {% load static %} {% block custom_title %}
<title>{{ post.title }}</title>
{% endblock %} {% block content %}

<!-- Details for a single post -->
<div class="post-details">
    <h2 class="posttitle">{{ post.title }}</h2>
    {% if post.published_date %}
    <div class="date postdate">
        Written by <a class="mr-2" href="{% url 'user_posts' post.author.username %}">{{ post.author }}</a> on {{post.published_date|date:"D M Y"}}
    </div>
    {% else %} {% if post.author == request.user %}
    <a class="btn btn-primary" href="{% url 'post_publish' pk=post.pk %}">Publish</a> {% endif %} {% endif %}

    <p class="postcontent">{{post.text|striptags|safe|linebreaksbr}}</p>

    <!-- Include likes-form-->
    <div id="like-comment-section">
        {% include 'forum/likes_form.html' %}
    </div>

    <!-- Buttons for editing and removing posts -->
    {% if user.is_authenticated %} {% if post.author == request.user %}
    <a class="btn btn-default post-edit" href="{% url 'post_edit' pk=post.pk %}"><i class="fa fa-edit"></i></a>
    <a class="btn btn-danger post-remove" href="{% url 'post_remove' pk=post.pk %}"><i class="fa fa-trash-alt"></i></a> {% endif %} {% endif %}

    <!-- Button for adding a comment -->
    <hr>
    <!-- Add comment button only if the post is published -->
    {% if post.published_date %}
    <a class="btn btn-primary btn-comment" href="{% url 'add_comment_to_post' pk=post.pk %}">Add Comment</a> {% endif %}

    <!-- Comments container with details of all comments -->
    <!-- If the comment is approved show the comment and the creation date -->
    <!-- If the comment is not approved add buttons for removing and approving the comment for the superuser-->
    <!-- If there are no comments add a paragraph with a text of 'No Comments' -->
    <div class="container comments-container">
        {% for comment in post.comments.all %}
        <br> {% if user.is_authenticated %} {% if not comment.approved_comment %} {% if user.is_superuser %}
        <p>{{ comment.created_date }}</p>
        <p>{{comment.text|safe|linebreaks}}</p>
        <p>Posted By: {{comment.author}}</p>
        <a class="btn btn-danger comment-remove" href="{% url 'comment_remove' pk=comment.pk %}"><i class="fa fa-trash"></i></a>
        <a class="btn btn-primary comment-approve" href="{% url 'comment_approve' pk=comment.pk %}"><i class="fa fa-check"></i></a> {% endif %} {% endif %} {% if comment.approved_comment and not comment.reply %}
        <p>{{ comment.created_date }}</p>
        <p>{{comment.text|safe|linebreaks}}</p>
        <p>Posted By: {{comment.author}}</p>
        
        <div>
            <!-- Comment edit and delete buttons -->
            {% if comment.author == request.user %}
            <a class="btn btn-default comment-edit" href="{% url 'comment_edit' pk=comment.pk %}"><i class="fa fa-edit"></i></a>
            <a class="btn btn-danger comment-remove" href="{% url 'comment_remove' pk=comment.pk %}"><i class="fa fa-trash"></i></a>
            {% endif %}
        
            <!-- Reply button and reply blockquote container-->
            <a class="btn btn-primary btn-reply" href="{% url 'add_reply_to_comment' pk=post.pk id=comment.id %}">Reply</a> {% endif %} {% for reply in comment.replies.all %}
        </div>
        <blockquote class="blockquote">
            {{ reply.created_date}}
            <br> {{reply.text|safe|linebreaks|striptags}}
            <br> Posted By: {{ reply.author|striptags }}
            <div>
                <a class="btn btn-default comment-edit" href="{% url 'edit_reply' pk=post.pk id=reply.id %}"><i class="fa fa-edit"></i></a>
                <a class="btn btn-danger comment-remove" href="{% url 'reply_remove' pk=reply.pk %}"><i class="fa fa-trash"></i></a>
            </div>
        </blockquote>
        <br> {% endfor %} {% endif %} {% empty %}
        <p>No Comments</p>
        {% endfor %}
    </div>
</div>
{% endblock %}
<!-- Include forum-box -->
{% block forum %} {% include 'includes/forum-box.html' %} {% endblock %} {% block custom_js %}
<script src="{% static 'js/custom/ajax_likes.js' %}"></script>
{% endblock %}
